# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

This is a Next.js PWA (Progressive Web App) todo application with Firebase Firestore backend and offline-first functionality. The app supports offline task management with automatic synchronization when connectivity is restored.

## Development Commands

- `npm run dev` - Start development server
- `npm run build` - Build for production
- `npm start` - Start production server
- `npm run lint` - Run ESLint

## Architecture

### Core Technologies
- **Next.js 14** - React framework with App Router
- **Firebase Firestore** - Real-time database
- **next-pwa** - PWA functionality with service worker
- **React Hooks** - State management

### Key Components

#### Offline-First Architecture
- **useOfflineSync** hook (`hooks/useOfflineSync.js`) - Manages online/offline state and sync queue
- **useLocalStorage** hook (`hooks/useLocalStorage.js`) - Persistent local storage for offline data
- **OfflineIndicator** component - Shows connection status and sync progress
- Optimistic updates for all CRUD operations with rollback on failure

#### Firebase Integration
- Configuration via environment variables (see `firebaseConfig` in `pages/index.js:26-33`)
- Firestore collections: `todos` with fields: `text`, `completed`, `createdAt`
- Server timestamps used for proper ordering

#### PWA Features
- **Service Worker** - Automatic caching via next-pwa
- **App Manifest** - Full PWA installation support
- **Push Notifications** - Task completion/deletion notifications
- **Install Prompt** - Custom PWA installation UI

### State Management Pattern
The app uses a dual-state approach:
1. **Primary state** (`todos`) - Current UI state with optimistic updates
2. **Local backup** (`localTodos`) - Persistent fallback for offline scenarios
3. **Sync queue** - Tracks pending operations during offline periods

### Error Handling
- Automatic fallback to local data on Firebase errors
- Optimistic updates with rollback on operation failure
- Sync queue processing with individual operation error handling

## Firebase Environment Variables

Required environment variables for Firebase configuration:
- `NEXT_PUBLIC_FIREBASE_API_KEY`
- `NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN`
- `NEXT_PUBLIC_FIREBASE_PROJECT_ID`
- `NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET`
- `NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID`
- `NEXT_PUBLIC_FIREBASE_APP_ID`

## PWA Configuration

- **Manifest**: `public/manifest.json` - Supports Japanese locale
- **Icons**: Multiple sizes in `public/icons/` for various devices
- **Service Worker**: Auto-generated by next-pwa with custom caching strategies
- **Runtime Caching**: Google Fonts (CacheFirst) and Firebase API (NetworkFirst)

## Development Notes

- The app is primarily in Japanese for UI text
- Uses CSS Modules for styling
- All Firebase operations include offline handling
- Implements optimistic UI updates for better user experience
- No authentication - public todo list (suitable for single-user or demo scenarios)